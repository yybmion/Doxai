= src/docs-prompt.js
:toc:
:source-highlighter: highlight.js

== Overview

The `src/docs-prompt.js` is responsible for generating documentation prompts for use with a language model. It provides templates and functions to create prompts for both creating new documentation and updating existing documentation based on code changes.

[cols="1,3"]
|===
|PR Number|#42
|Author|@yybmion
|Created Date|2025-05-27
|Last Modified|2025-05-28 by @yybmion
|File Type|Class/Module
|Language|JavaScript
|===

== Detailed Description

This file defines a `DocsPromptGenerator` class that manages templates for generating prompts for creating or updating documentation. It uses a predefined set of templates for different languages (English and Korean) and different actions (create and update). The class also includes helper methods to format dates and determine the programming language from a filename. The generated prompts are designed to be used with a language model to automatically generate or update technical documentation. The module exports the `DocsPromptGenerator` class, as well as functions to generate the documentation prompts.

== Dependencies

* `./config` - This module likely contains configuration settings for the application. However, it is not used in the current code, so its specific purpose is unclear.

== Key Components

=== DocsPromptGenerator Class

The `DocsPromptGenerator` class is the core component of this file. It manages the templates and logic for generating documentation prompts.

=== getLanguageFromFilename(filename)

[source,javascript]
----
  getLanguageFromFilename(filename) {
    const extension = filename.split('.').pop().toLowerCase();
    return this.codeLanguageMap[extension] || extension.toUpperCase();
  }
----

*Function*: Determines the programming language from a given filename by extracting the file extension and looking it up in a predefined map. If the extension is not found in the map, it returns the extension in uppercase.

*Input*:
* `filename` (`string`) - The name of the file.

*Output*: `string` - The display name of the programming language, or the uppercase extension if the language is not found.

=== formatDate(dateString)

[source,javascript]
----
  formatDate(dateString) {
    return new Date(dateString).toISOString().split('T')[0];
  }
----

*Function*: Formats an ISO date string into a `YYYY-MM-DD` format.

*Input*:
* `dateString` (`string`) - An ISO date string.

*Output*: `string` - The formatted date string in `YYYY-MM-DD` format.

=== createDocsPrompt(filename, fileContent, prDetails, language = 'en')

[source,javascript]
----
  createDocsPrompt(filename, fileContent, prDetails, language = 'en') {
    const codeLanguage = this.getLanguageFromFilename(filename);
    const template = this.getTemplate(language, 'create', codeLanguage);

    return template
    .replace(/\${prNumber}/g, prDetails.number)
    .replace(/\${author}/g, prDetails.author)
    .replace(/\${createdDate}/g, this.formatDate(prDetails.createdAt))
    .replace(/\${updatedDate}/g, this.formatDate(prDetails.updatedAt))
    .replace(/\${updatedBy}/g, prDetails.mergedBy || prDetails.author)
    .replace(/\${filename}/g, filename)
    .replace(/\${fileContent}/g, fileContent);
  }
----

*Function*: Creates a documentation prompt for a new file. It retrieves the appropriate template based on the specified language and code language, then replaces placeholders in the template with the provided file and PR details.

*Input*:
* `filename` (`string`) - The name of the source file.
* `fileContent` (`string`) - The content of the source file.
* `prDetails` (`object`) - An object containing details about the pull request, including `number`, `author`, `createdAt`, `updatedAt`, and `mergedBy`.
* `language` (`string`, optional) - The language of the documentation (either 'ko' for Korean or 'en' for English). Defaults to 'en'.

*Output*: `string` - The generated documentation prompt.

=== createUpdateDocsPrompt(filename, fileContent, existingDocContent, prDetails, language = 'en')

[source,javascript]
----
  createUpdateDocsPrompt(filename, fileContent, existingDocContent, prDetails, language = 'en') {
    const codeLanguage = this.getLanguageFromFilename(filename);
    const template = this.getTemplate(language, 'update', codeLanguage);

    return template
    .replace(/\${prNumber}/g, prDetails.number)
    .replace(/\${author}/g, prDetails.author)
    .replace(/\${createdDate}/g, this.formatDate(prDetails.createdAt))
    .replace(/\${updatedDate}/g, this.formatDate(prDetails.updatedAt))
    .replace(/\${updatedBy}/g, prDetails.mergedBy || prDetails.author)
    .replace(/\${filename}/g, filename)
    .replace(/\${fileContent}/g, fileContent)
    .replace(/\${existingDocContent}/g, existingDocContent);
  }
----

*Function*: Creates a documentation update prompt for an existing file. It retrieves the appropriate template based on the specified language and code language, then replaces placeholders in the template with the provided file, PR details, and existing documentation content.

*Input*:
* `filename` (`string`) - The name of the source file.
* `fileContent` (`string`) - The content of the source file.
* `existingDocContent` (`string`) - The existing documentation content.
* `prDetails` (`object`) - An object containing details about the pull request, including `number`, `author`, `createdAt`, `updatedAt`, and `mergedBy`.
* `language` (`string`, optional) - The language of the documentation (either 'ko' for Korean or 'en' for English). Defaults to 'en'.

*Output*: `string` - The generated documentation update prompt.

=== getTemplate(language, type, codeLanguage)

[source,javascript]
----
  getTemplate(language, type, codeLanguage) {
    const templates = {
      ko: {
        create: `# 코드 문서화 요청
...`,

        update: `# 코드 문서 업데이트 요청
...`
      },

      en: {
        create: `# Documentation Request
...`,

        update: `# Documentation Update Request
...`
      }
    };

    const languageTemplates = templates[language] || templates.en;
    return languageTemplates[type] || languageTemplates.create;
  }
----

*Function*: Retrieves a template string based on the specified language, type (create or update), and code language. It uses a nested object to store the templates. If a template for the specified language or type is not found, it defaults to English or the "create" template, respectively.

*Input*:
* `language` (`string`) - The language of the documentation (either 'ko' for Korean or 'en' for English).
* `type` (`string`) - The type of prompt (either 'create' for new documentation or 'update' for updating existing documentation).
* `codeLanguage` (`string`) - The programming language of the code.

*Output*: `string` - The template string.

=== getSystemPrompt(language = 'en')

[source,javascript]
----
  getSystemPrompt(language = 'en') {
    const prompts = {
      ko: `당신은 코드 문서화 전문가입니다. ...`,

      en: `You are a code documentation expert. ...`
    };

    return prompts[language] || prompts.en;
  }
----

*Function*: Returns a system prompt based on the specified language. If the language is not found, it defaults to English.

*Input*:
* `language` (`string`, optional) - The language of the prompt (either 'ko' for Korean or 'en' for English). Defaults to 'en'.

*Output*: `string` - The system prompt.

=== getAsciiDocTemplate()

[source,javascript]
----
  getAsciiDocTemplate() {
    return `= {Class/File Name}
:toc:
:source-highlighter: highlight.js

== Overview

The \`{Class/File Name}\` is responsible for {main functionality description}. {Brief explanation of role in the system}

[cols="1,3"]
|===
|PR Number|#{PR Number}
|Author|@{Author}
|Created Date|{Creation Date}
|Last Modified|{Last Modified Date} by @{Modifier}
|===

== Detailed Description

{Detailed description of the class/file - 2-3 paragraphs explaining specific functionality, purpose, design intentions, etc.}

== Main Use Cases

[source,javascript]
----
// Simple example code using this class/file
const instance = new {ClassName}(...);
instance.{mainMethod}(...);
----

== Dependencies

* \`{Dependency1}\` - {Purpose of the dependency and its relationship with this class}
* \`{Dependency2}\` - {Purpose of the dependency and its relationship with this class}

== Key Methods

=== {MethodName}({parameter types and names})

[source,{language}]
----
// Method signature and main logic only
{Simplified method code - focus on core logic}
----

*Purpose*: {Specific purpose of the method and what it accomplishes}

*Parameters*:

* \`{ParameterName}\` - {Type and purpose, constraints if any}

*Return Value*: {Return type and meaning, possible range of return values}

*Exceptions*:

* \`{ExceptionName}\` - {When it occurs and how to handle it}

*Usage Example*:

[source,{language}]
----
// Example code using this method
const result = instance.{methodName}(params);
----

== Important Notes

* {Important considerations when using this code}
* {Known limitations or cautions}`;
  }
----

*Function*: Returns a template string for AsciiDoc documentation. This template provides a basic structure for documenting code, including sections for overview, detailed description, dependencies, key methods, and important notes.

*Output*: `string` - The AsciiDoc template string.

== Implementation Features

The `DocsPromptGenerator` uses template strings and regular expressions to dynamically generate prompts. It also uses a language map to associate file extensions with programming language names. The class uses a singleton pattern to ensure that only one instance of the class is created.

== Notes

* The templates are hardcoded within the `getTemplate` method. It might be beneficial to load these templates from external files to allow for easier customization and maintenance.
* The `config` dependency is not used in the current code. It should be removed if it's not needed, or its purpose should be clarified.
* The `getSystemPrompt` method returns a prompt intended for the LLM, but the prompt includes a call to `this.getAsciiDocTemplate()`, which returns the AsciiDoc template structure. This seems redundant as the `getAsciiDocTemplate` is already used in the `getTemplate` method.
