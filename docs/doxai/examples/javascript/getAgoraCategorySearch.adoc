= examples/javascript/getAgoraCategorySearch.ts
:toc:
:source-highlighter: highlight.js

== 개요

`getAgoraCategorySearch.ts`는 특정 카테고리에 속하는 아고라(Agora) 목록을 검색하고 가져오는 기능을 제공합니다. `@tanstack/react-query` 라이브러리의 `QueryFunction`을 사용하여 데이터를 비동기적으로 가져오고 캐싱합니다.

[cols="1,3"]
|===
|PR 번호|#42
|작성자|@yybmion
|작성일|2025-05-27
|마지막 수정|2025-05-28 by @yybmion
|파일 유형|함수
|언어|TypeScript
|===

== 상세 설명

이 파일은 아고라 목록을 검색하기 위한 핵심 로직을 담고 있습니다.  `getAgoraCategorySearch` 함수는 서버에서 아고라 데이터를 가져오고, 에러를 처리하며, 다음 페이지를 위한 커서(cursor) 정보를 반환합니다.  이 함수는 React Query를 사용하여 컴포넌트에서 쉽게 데이터를 가져오고 관리할 수 있도록 설계되었습니다.

== 의존성

* `UnionAgora` (from '@/app/model/Agora') - 아고라 데이터의 타입을 정의합니다.
* `AGORA_CATEGORY_SEARCH`, `NETWORK_ERROR_MESSAGE` (from '@/constants/responseErrorMessage') - API 호출 실패 시 발생할 수 있는 다양한 에러 메시지를 정의합니다.
* `callFetchWrapper` (from '@/lib/fetchWrapper') - API 호출을 래핑하여 에러 처리 및 재시도 로직을 중앙 집중화합니다.
* `QueryFunction` (from '@tanstack/react-query') - React Query에서 데이터를 가져오는 함수에 대한 타입을 정의합니다.

== 주요 구성요소

=== getAgoraCategorySearch

[source,typescript]
----
export const getAgoraCategorySearch: QueryFunction<
    { agoras: UnionAgora[]; nextCursor: number | null },
    [_1: string, _2: string, _3: string, searchParams: SearchParams],
    { nextCursor: number | null }
> = async ({ queryKey, pageParam = { nextCursor: null } }) => { ... }
----

*기능*: 특정 카테고리에 속하는 아고라 목록을 검색하고, 다음 페이지를 위한 커서 정보를 반환합니다. React Query의 `QueryFunction` 인터페이스를 구현하여 데이터 fetching을 수행합니다.

*입력값*:
* `queryKey` (`string[]`) - React Query에서 사용하는 쿼리 키 배열입니다. 여기에는 상태(status), 카테고리(category) 등의 검색 조건이 포함됩니다.
* `pageParam` (`{ nextCursor: number | null }`) - 다음 페이지를 가져오기 위한 커서 정보입니다. 초기값은 `{ nextCursor: null }` 입니다.

*출력값*: `{ agoras: UnionAgora[]; nextCursor: number | null }` - 아고라 목록과 다음 페이지를 위한 커서 정보를 담은 객체를 반환합니다. `nextCursor`가 `null`이면 다음 페이지가 없음을 의미합니다.

== 구현 특징

* **에러 처리**: API 호출 실패 시 다양한 에러 코드를 기반으로 상세한 에러 메시지를 생성하여 사용자에게 제공합니다.  `AGORA_CATEGORY_SEARCH`와 `NETWORK_ERROR_MESSAGE` 상수를 활용하여 에러 메시지를 관리합니다.
* **페이징**: `nextCursor` 파라미터를 사용하여 페이징을 구현합니다. API 응답에 `hasNext` 플래그와 `next` 커서 값이 포함되어 다음 페이지를 가져올 수 있는지 여부를 판단합니다.
* **fetchWrapper 활용**: `callFetchWrapper` 함수를 사용하여 API 호출을 래핑하고, 공통적인 에러 처리 로직을 재사용합니다.
* **URLSearchParams 사용**: 검색 파라미터를 URL에 추가하기 위해 `URLSearchParams` API를 사용합니다.

== 주의사항

* `callFetchWrapper` 함수의 동작 방식과 반환 값에 대한 이해가 필요합니다.
* API 엔드포인트(`/api/v1/open/agoras`)와 응답 데이터 구조가 변경될 경우 코드를 수정해야 합니다.
* 에러 코드와 메시지는 `constants/responseErrorMessage.ts` 파일에 정의되어 있으므로, 필요에 따라 해당 파일을 확인해야 합니다.
* React Query의 `queryKey` 구조를 정확히 이해하고 사용해야 합니다. 잘못된 `queryKey`는 예상치 못한 동작을 유발할 수 있습니다.
