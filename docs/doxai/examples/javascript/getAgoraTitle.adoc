= examples/javascript/getAgoraTitle.ts
:toc:
:source-highlighter: highlight.js

== Overview

The `getAgoraTitle.ts` file defines a function that fetches the title and related information (status, image URL, color) for a specific Agora (a collaborative space or project) from a backend API. It uses the `@tanstack/react-query` library for data fetching and caching.

[cols="1,3"]
|===
|PR Number|#42
|Author|@yybmion
|Created Date|2025-05-27
|Last Modified|2025-05-28 by @yybmion
|File Type|Function
|Language|TypeScript
|===

== Detailed Description

This file contains a `getAgoraTitle` function designed to retrieve Agora details from an API endpoint. It's specifically tailored to fetch the title, status, image URL, and color associated with a given Agora ID. The function handles potential errors, such as the Agora not existing or network issues, and throws specific error messages to aid in debugging and error handling. It leverages `react-query`'s `QueryFunction` type for type safety and integration with React Query hooks.

== Dependencies

* `@tanstack/react-query` - Provides the `QueryFunction` type, enabling type-safe data fetching and caching.
* `getSelectedAgoraQueryKey` (aliased as `getSelectedAgoraTags`) from `'@/constants/queryKey'` -  Generates a query key (used as a tag) for the Agora, allowing for cache invalidation and refetching when the Agora data changes.
* `callFetchWrapper` from `'@/lib/fetchWrapper'` - A wrapper around the standard `fetch` API, likely providing centralized error handling, request configuration, and response parsing.
* `AGORA_INFO`, `NETWORK_ERROR_MESSAGE` from `'@/constants/responseErrorMessage'` - Contains predefined error messages related to Agora information retrieval and network connectivity issues.
* `Status` from `'@/app/model/Agora'` - Defines the possible status values for an Agora (e.g., active, inactive).

== Key Components

=== getAgoraTitle

[source,typescript]
----
export const getAgoraTitle: QueryFunction<
    { title: string; status: Status | ''; imageUrl: string; agoraColor: string },
    [_1: string, _2: string]
> = async ({ queryKey }) => { ... }
----

*Function*: Fetches the title, status, image URL, and color of a specific Agora from the backend API.

*Input*:
* `queryKey` (`string[]`) - An array containing the query key. The second element (`queryKey[1]`) is expected to be the `agoraId`.

*Output*: `{ title: string; status: Status | ''; imageUrl: string; agoraColor: string }` - An object containing the Agora's title, status, image URL, and color.  Returns this data if the API call is successful. Throws an error if the API call fails.

== Implementation Features

* **Error Handling:** The function includes comprehensive error handling, checking for various error conditions such as non-existent Agora, network issues, and unknown errors.  It throws specific error messages based on the error code received from the API.
* **Caching:** The `next: { tags: getSelectedAgoraTags(agoraId) }` option suggests that the response is tagged with a query key, enabling Next.js's built-in data cache to be invalidated when the Agora data changes.
* **Fetch Wrapper:** Uses `callFetchWrapper` to handle the API call, centralizing concerns like authentication, error handling, and request configuration.
* **Type Safety:** Uses the `QueryFunction` type from `@tanstack/react-query` to ensure type safety for the query function.

== Notes

* The `getSelectedAgoraTags` function is crucial for cache invalidation.  Changes to the Agora data should trigger an invalidation of the cache associated with the tag returned by this function.
* The `callFetchWrapper` function is assumed to handle authentication and other common request configurations.
* The `homeSegmentKey` variable is commented out, suggesting a potential redirect functionality that is currently disabled. The purpose of this redirect is not clear from the code.
* The `[_1: string, _2: string]` type definition in the `QueryFunction` suggests that the query key is expected to be an array of two strings.
